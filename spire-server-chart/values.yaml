# Default values for spire-server-chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

imageMain:
  name: spire-server
  repository: ghcr.io/spiffe/spire-server
  pullPolicy: Always
  tag: 1.5.1
imageSidecar:
  name: spire-sidecar
  repository: accuknox/spire-sidecar
  pullPolicy: Always
  tag: v0.1

imagePullSecrets: []

serviceAccount:
  create: true
  name: spire-server


# lables
labels:
  app: spire-server

#Role
Role:
  create: true
  name: spire-server-configmap-role
  rules:
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch", "patch"]

#roleBinding
roleBinding:
  create: true
  name: spire-server-configmap-role-binding
  roleref:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: spire-server-configmap-role
  subjects:
  - kind: ServiceAccount
    name: spire-server

#clusterRole
clusterRole:
  create: true
  name: spire-server-trust-role
  rules:
  - apiGroups: ["authentication.k8s.io"]
    resources: ["tokenreviews"]
    verbs: ["create"]

#clusterRoleBinding
clusterRoleBinding:
  create: true
  name: spire-server-trust-role-binding
  subjects:
  - kind: ServiceAccount
    name: spire-server
    namespace: spire
  roleref:
    kind: ClusterRole
    name: spire-server-trust-role
    apiGroup: rbac.authorization.k8s.io

#service
service:
  enabled: true
  type: LoadBalancer
  port: 8081
  targetPort: 8081
  protocol: TCP
  name: api

#Health Check
healthService:
  enabled: true
  port: 8080
  targetPort: 8080
  protocol: TCP
  name: health

#ingress Layer 7 certificate Loadbalancer
ingress:
  enabled: false

#configmapServer
configmapServer:
  name:  spire-server
  enabled: true
  file: configmaps/server.conf
#configmap default entry
configmapEntry:
  name: spire-default-entry
  enabled: true
  file: configmaps/entry.sh

#configmap ca certificates
configmapCAServer:
  name:  spire-server-ca
  enabled: true
  crt: configmaps/upstream_ca.crt
  key: configmaps/upstream_ca.key

#Volumes
volumes:
- name: spire-config
  configMap:
    name: spire-server
- name: spire-default-entry
  configMap:
    name: spire-default-entry
- name: spire-server-ca
  configMap:
    name: spire-server-ca
- name: spire-server-socket
  emptyDir: {}

#Volume-Mounts
volumeMainMounts:
- name: spire-config
  mountPath: /run/spire-server/config
  readOnly: true
- name: spire-server-ca
  mountPath: /run/spire-server/ca
  readOnly: true
- name: spire-server-socket
  mountPath: /tmp/spire-server/private

#Volume-Mounts
volumeSidecarMounts:
- name: spire-server-socket
  mountPath: /tmp/spire-server/private
  readOnly: false
- name: spire-default-entry
  mountPath: /run/spire-server/config
  readOnly: true

#Resources 
resources:
  limits:
    memory: 1000Mi
    cpu: 500m
  requests:
    memory: 100Mi
    cpu: 100m
    

#HPA
autoscaling:
  enabled: false
  targetCPUUtilizationPercentage: 75
  targetMemoryUtilizationPercentage: 75
  minReplicas: 2
  maxReplicas: 5

nodeSelector: {}

tolerations: []

affinity: {}